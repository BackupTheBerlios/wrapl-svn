#!/usr/local/bin/riva
MOD Main;

IMP Std.String;
IMP Std.Symbol;
IMP IO.Terminal USE In, Out;
IMP Wrapl;
IMP Sys.Module;

Out:write("Interactive Wrapl Version: " + Wrapl.Version + "\n");

VAR Session <- Wrapl.SessionNew(In);
VAR Result;

REP (
	Out:write("--> ");
	(Result <- Session:eval) => (
		Out:write(Result);
		RECV Msg DO Msg IN Symbol.NoMethodMessageT => (
			VAR mod;
			(mod <- Module.FromVal(Result)) => (
				Out:writes(mod[1]:map("/", "."), ".", mod[2]);
			) // (
				Out:write("<value>");
			);
		) // (
			SEND Msg;
		);
	) // (
		Out:write("failure");
	);
	RECV msg DO msg IN Wrapl.ErrorMessageT => (
		Out:writes("console", msg);
	) // (
		Out:write("Unhandled message: ");
		Out:write(msg);
		RECV msg2 DO Out:write("<value>");
	);
);

END Main.
